<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¦ãƒ³ãƒã‚’æã“ã†!!</title>
    <style>
        canvas {
            border: 1px solid black;
            cursor: crosshair;
        }
        .color-button, .tool-button {
            margin: 5px;
            padding: 10px;
            border: none;
            cursor: pointer;
            color: white;
            font-size: 16px;
        }
        .red { background-color: rgb(241, 109, 0); }
        .blue { background-color: rgba(47, 19, 3, 0.811); }
        .green { background-color: rgb(183, 128, 0); }
        .yellow { background-color: rgb(125, 67, 0); color: black; }
        .eraser { background-color: gray; }
        .clear { background-color: black; }
        .send { background-color: orange; color: black; }
    </style>
</head>
<body>
    <h1>ã‚¦ãƒ³ãƒã‚’æã“ã†!!</h1>
    <p>ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦è‰²ã‚’å¤‰æ›´ã—ãŸã‚Šã€æ¶ˆã—ã‚´ãƒ ã‚„å…¨ã‚¯ãƒªã‚¢ã‚’ä½¿ãˆã¾ã™ã€‚</p>
    <!-- è‰²å¤‰æ›´ãƒœã‚¿ãƒ³ -->
    <button class="color-button red">èµ¤ã„èŒ¶è‰²</button>
    <button class="color-button blue">é»’ã„èŒ¶è‰²</button>
    <button class="color-button green">è–„ã„èŒ¶è‰²</button>
    <button class="color-button yellow" id="defaultColor">èŒ¶è‰²</button>
    <!-- ãƒ„ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ -->
    <button class="tool-button eraser" data-tool="eraser">æ¶ˆã—ã‚´ãƒ </button>
    <button class="tool-button clear" data-tool="clear">å…¨éƒ¨ã‚¯ãƒªã‚¢</button>
    <!-- ç”»åƒé€ä¿¡ãƒœã‚¿ãƒ³ -->
    <button class="tool-button send" id="sendButton">ç”»åƒã‚’é€ä¿¡</button>
    <canvas id="drawingCanvas" width="600" height="400"></canvas>
    <div id="result"></div>

    <script>
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');

        // åˆæœŸè¨­å®š
        const defaultColorButton = document.getElementById('defaultColor');
        const defaultColorStyle = window.getComputedStyle(defaultColorButton).backgroundColor; // CSSã‹ã‚‰èƒŒæ™¯è‰²ã‚’å–å¾—
        ctx.lineWidth = 5; // ç·šã®å¤ªã•
        ctx.lineCap = 'round'; // ç·šã®ç«¯ã‚’ä¸¸ã
        let currentColor = defaultColorStyle; // åˆæœŸã®è‰²ã‚’CSSã®èŒ¶è‰²ã«è¨­å®š
        ctx.strokeStyle = currentColor;

        let isDrawing = false;
        let lastX = 0, lastY = 0;
        let isEraser = false; // æ¶ˆã—ã‚´ãƒ ãƒ¢ãƒ¼ãƒ‰ã‹ã©ã†ã‹

        // æç”»é–‹å§‹
        canvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            [lastX, lastY] = [e.offsetX, e.offsetY];
        });

        // æç”»ä¸­
        canvas.addEventListener('mousemove', (e) => {
            if (!isDrawing) return;
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(e.offsetX, e.offsetY);
            ctx.strokeStyle = isEraser ? 'white' : currentColor; // æ¶ˆã—ã‚´ãƒ ãªã‚‰ç™½
            ctx.stroke();
            [lastX, lastY] = [e.offsetX, e.offsetY];
        });

        // æç”»çµ‚äº†
        canvas.addEventListener('mouseup', () => isDrawing = false);
        canvas.addEventListener('mouseout', () => isDrawing = false);

        // è‰²å¤‰æ›´ãƒœã‚¿ãƒ³ã®å‡¦ç†
        const colorButtons = document.querySelectorAll('.color-button');
        colorButtons.forEach(button => {
            button.addEventListener('click', () => {
                isEraser = false; // æ¶ˆã—ã‚´ãƒ ãƒ¢ãƒ¼ãƒ‰ã‚’è§£é™¤

                // CSSã®èƒŒæ™¯è‰²ã‚’å–å¾—ã—ã¦ç·šã®è‰²ã«è¨­å®š
                const buttonStyle = window.getComputedStyle(button);
                currentColor = buttonStyle.backgroundColor;
                ctx.strokeStyle = currentColor; // æç”»è‰²ã‚’æ›´æ–°
            });
        });

        // æ¶ˆã—ã‚´ãƒ ã‚„å…¨ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã®å‡¦ç†
        const toolButtons = document.querySelectorAll('.tool-button');
        toolButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tool = button.getAttribute('data-tool');
                if (tool === 'eraser') {
                    isEraser = true; // æ¶ˆã—ã‚´ãƒ ãƒ¢ãƒ¼ãƒ‰
                    ctx.lineWidth = 10; // æ¶ˆã—ã‚´ãƒ ã‚’å¤ªãã™ã‚‹ï¼ˆä»»æ„ï¼‰
                } else if (tool === 'clear') {
                    ctx.clearRect(0, 0, canvas.width, canvas.height); // å…¨ã‚¯ãƒªã‚¢
                    isEraser = false; // æ¶ˆã—ã‚´ãƒ ãƒ¢ãƒ¼ãƒ‰ã‚’è§£é™¤
                }
            });
        });

        // ç”»åƒé€ä¿¡ãƒœã‚¿ãƒ³ã®å‡¦ç†
        const sendButton = document.getElementById('sendButton');
        const resultDiv = document.getElementById('result');

        sendButton.addEventListener('click', async () => {
    const imageData = canvas.toDataURL('image/png'); // ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’Base64å½¢å¼ã§å–å¾—
    console.log("é€ä¿¡ãƒ‡ãƒ¼ã‚¿: ", imageData); // ãƒ‡ãƒãƒƒã‚°ç”¨

    try {
        const response = await fetch('/upload', { // Flaskã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ '/upload' ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
            method: 'POST',
            headers: {
                'Content-Type': 'application/json', // JSONå½¢å¼ã§é€ä¿¡
            },
            body: JSON.stringify({ image: imageData }), // ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
        });

        if (response.ok) {
            const result = await response.json();
            console.log("ã‚µãƒ¼ãƒãƒ¼ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹: ", result); // ãƒ‡ãƒãƒƒã‚°ç”¨
            resultDiv.textContent = `åˆ¤å®šçµæœ: ğŸ’©ã«ä¼¼ã¦ã„ã‚‹åº¦ã¯ ${result.similarity}% ã§ã™ï¼`;
        } else {
            console.error("ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: ", response.status, response.statusText);
            resultDiv.textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
        }
    } catch (error) {
        console.error("é€šä¿¡ã‚¨ãƒ©ãƒ¼: ", error); // ãƒ‡ãƒãƒƒã‚°ç”¨
        resultDiv.textContent = 'é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
    }
});


    </script>
</body>
</html>
